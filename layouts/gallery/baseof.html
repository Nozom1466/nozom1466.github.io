<!doctype html>
{{- $theme := .Params.theme | default "dark" }}
<html data-theme="{{- if (eq $theme "light") -}}light{{- else -}}dark{{- end -}}" lang="{{- site.LanguageCode | default "en" -}}">
  {{ partial "gallery-theme/head.html" . }}
  <body style="margin: 0;">
    <style>
      .gallery-header {
        padding: 0.4em 2rem;
        background: var(--header-bg, #1a1a1a);
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 2rem;
        min-height: auto;
      }
      .gallery-header-title {
        font-size: 1.2em;
        font-weight: bold;
        text-decoration: none;
        color: var(--text-1);
        padding: 0.3em 0;
        margin: 0;
      }
      .gallery-header-nav {
        display: flex;
        gap: 2rem;
        align-items: center;
        margin: 0;
      }
      .gallery-header-nav a {
        font-size: 14px;
        text-decoration: none;
        color: var(--text-1);
        margin: 0;
      }
      .gallery-header-nav a i {
        margin-right: 0.3em;
      }
      .gallery-header-nav button {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.3em;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-1);
        font-size: 1em;
      }
      .gallery-hamburger {
        display: none;
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.5em;
        color: var(--text-1);
        font-size: 1.2em;
      }
      
      @media (max-width: 767px) {
        .gallery-header {
          flex-wrap: wrap;
          padding: 0.4em 1rem;
          gap: 0;
        }
        .gallery-header-title {
          flex: 1;
        }
        .gallery-hamburger {
          display: block;
        }
        .gallery-header-nav {
          display: none;
          flex-direction: column;
          width: 100%;
          gap: 0;
          padding: 0.5em 0;
        }
        .gallery-header-nav.open {
          display: flex;
        }
        .gallery-header-nav a {
          padding: 0.8em 0;
          width: 100%;
          text-align: center;
          border-top: 1px solid var(--border, #555);
        }
        .gallery-header-nav button {
          padding: 0.8em 0;
          width: 100%;
          justify-content: center;
          border-top: 1px solid var(--border, #555);
        }
      }
    </style>
    <header class="gallery-header">
      <a href="{{ "/" | relURL }}" class="gallery-header-title">
        Fries Gallery
      </a>
      <button class="gallery-hamburger" onclick="document.querySelector('.gallery-header-nav').classList.toggle('open')">
        <i class="fa fa-bars"></i>
      </button>
      <nav class="gallery-header-nav">
        <a href="{{ "/" | relURL }}"><i class="fa fa-home"></i>Home</a>
        <a href="{{ "/library" | relURL }}"><i class="fa fa-book"></i>Library</a>
        <button id="toggle-theme" title="Toggle theme">
          <i class="fa fa-moon" id="theme-icon-dark" style="display: none;"></i>
          <i class="fa fa-sun" id="theme-icon-light" style="display: none;"></i>
        </button>
      </nav>
    </header>
    <main style="max-width: none; width: 100%; padding: 0; box-sizing: border-box;">
      {{ block "main" . }}{{ end }}
    </main>
    {{ partial "gallery-theme/footer.html" . }}
    <script>
    (function() {
      // Local storage helper with expiry
      const localDB = {
        set: function(key, value, ttl) {
          if (ttl === 0) return;
          const now = new Date();
          const expiryDay = ttl * 86400000;
          const item = {
            value: value,
            expiry: now.getTime() + expiryDay
          };
          localStorage.setItem(key, JSON.stringify(item));
        },
        get: function(key) {
          const itemStr = localStorage.getItem(key);
          if (!itemStr) {
            return undefined;
          }
          const item = JSON.parse(itemStr);
          const now = new Date();
          if (now.getTime() > item.expiry) {
            localStorage.removeItem(key);
            return undefined;
          }
          return item.value;
        }
      };

      // Theme management
      const theme = {
        updateIcons: function(currentTheme) {
          const darkIcon = document.getElementById('theme-icon-dark');
          const lightIcon = document.getElementById('theme-icon-light');
          if (currentTheme === 'dark') {
            darkIcon.style.display = 'none';
            lightIcon.style.display = 'inline';
          } else {
            darkIcon.style.display = 'inline';
            lightIcon.style.display = 'none';
          }
        },
        toggle: function(newTheme) {
          document.documentElement.setAttribute('data-theme', newTheme);
          localDB.set('theme', newTheme, 2);
          this.updateIcons(newTheme);
        },
        init: function() {
          const localState = localDB.get('theme');
          const currentTheme = localState || document.documentElement.getAttribute('data-theme') || 'dark';
          if (localState) {
            document.documentElement.setAttribute('data-theme', localState);
          }
          this.updateIcons(currentTheme);
          
          // Listen for system theme changes
          window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(evt) {
            if (!localDB.get('theme')) {
              theme.toggle(evt.matches ? 'dark' : 'light');
            }
          });
        }
      };

      // Initialize on DOM ready
      document.addEventListener('DOMContentLoaded', function() {
        theme.init();
        
        // Toggle button click handler
        document.getElementById('toggle-theme').addEventListener('click', function() {
          const currentTheme = document.documentElement.getAttribute('data-theme');
          theme.toggle(currentTheme === 'dark' ? 'light' : 'dark');
        });
      });
    })();
    </script>
  </body>
</html>
